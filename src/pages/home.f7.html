
<template>
  <div class="page" data-name="home">
  
    <!-- Scrollable page content-->
    <div class="page-content">
      <!--<div class="block-title margin-bottom-half margin-top-half">Home</div>-->
      
      <div class="navbar">
        <div class="navbar navbar-bg"></div>
      <div class="navbar-inner sliding">
        <img src="static/icons/favicon.png" class="margin-left-half logoIcon">
        <div class="title padding-half no-margin logoname">Flex Business</div>
        <!--<div class="right">
          <a href="Landing/default.html" target="_blank" class="link icon-only external">
            <i class="icon f7-icons if-not-md">info_circle_fill</i>
            <i class="icon material-icons if-md">info_circle_fill</i>
          </a>
        </div>-->
      </div>
    </div>

      <!--<div class="block block-strong margin-bottom-half no-margin-top">
        <p>Here is your blank Framework7 app. Let's see what we have here.</p>
      </div>-->
      <div class="parentWrap">
      
      <div class="no-margin-top margin-bottom-half" style="width:100%">
        <div class="row padding-horizontal-half">
          <div class="col">
            <div class="text-align-center compName padding-vertical-half no-margin-vertical display-flex align-items-center"></div>
            </div>
        </div>
          <div class="row padding-horizontal-half">
            <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                    <a href="/ingredient/" data-reload-all="true" class="item-content item-link">
                      <div class="item-inner">
                        <div class="item-title myPurple">
                          <i class="icon f7-icons text-color-blue1">layers_alt</i>
                          <div>Raw Materials</div>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

              <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                  <a href="/products/" data-reload-all="true" class="item-content item-link">
                    <div class="item-inner">
                      <div class="item-title myPurple">
                        <i class="icon f7-icons text-color-blue1">cube_box</i>
                        <div>Products</div>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="row padding-horizontal-half">
            <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                    <a href="/sales/" data-reload-all="true" class="item-content item-link">
                      <div class="item-inner">
                        <div class="item-title myPurple">
                          <i class="icon f7-icons text-color-blue1">tag</i>
                          <div>Sales / Estimates</div>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

              <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                    <a href="/expenses/" data-reload-all="true" class="item-content item-link">
                    <div class="item-inner">
                      <div class="item-title myPurple">
                        <i class="icon f7-icons text-color-blue1">purchased</i>
                        <div>Expenses</div>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="row padding-horizontal-half">
            <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                    <a href="/customers/" data-reload-all="true" class="item-content item-link">
                      <div class="item-inner">
                        <div class="item-title myPurple">
                          <i class="icon f7-icons text-color-blue1">person_2</i>
                          <div>Customers</div>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

              <div class="col">
                <div class="card myCard">
                  <div class="card-content text-align-center padding-vertical">
                    <a href="/reports/" data-reload-all="true" class="item-content item-link">
                    <div class="item-inner">
                      <div class="item-title myPurple">
                        <i class="icon f7-icons text-color-blue1">chart_bar</i>
                        <div>Reports</div>
                      </div>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="row padding-horizontal-half">
            <div class="col">
              <div class="card myCard">
                <div class="card-content text-align-center padding-vertical">
                  <a @click="SignOutUser" class="item-content item-link">
                  <div class="item-inner">
                    <div class="item-title myPurple">
                      <i class="icon f7-icons text-color-blue1">cloud_upload</i>
                      <div>Log out</div>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>

            <div class="col">
              <div class="card myCard">
                <div class="card-content text-align-center padding-vertical">
                  <a href="/settings/" data-reload-all="true" class="item-content item-link">
                  <div class="item-inner">
                    <div class="item-title myPurple">
                      <i class="icon f7-icons text-color-blue1">gear_alt</i>
                      <div>Settings</div>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
          </div>
      </div>

      <!--<div class="no-margin-top" style="width: inherit;margin: auto;position: absolute;bottom: 0;">
        <div class="row padding-horizontal-half">
        <div class="col text-align-center">
          <div class="margin-bottom-half">
            <a href="#" data-actions=".my-actions" class="actions-open">Open <i class="icon f7-icons text-color-blue1">info_circle</i></a>
          </div>
          
        </div>
      </div>
    </div>-->

    <!--<div class="actions-modal my-actions">
      <a href="#" class="item-content item-link" @click="confirmDelete()">
        <div class="item-title text-color-white">
          <div class="text-align-center bg-color-red padding-vertical-half">
          <i class="icon f7-icons text-color-blue1">bin_xmark</i>
          <span style="vertical-align: bottom;margin-left: 5px;font-size: 1.2em;text-transform: none;">Delete your data from this device</span>
        </div>
      </div>
      </a>
    </div>-->

    </div>

     
    </div>
  </div>
</template>
<script>
//import Dexie from 'dexie';
import {fakeAlert} from '../js/myscript.js';
var dbSettings = null, dbSettingsImages = null, mogulsheetdb = null;
export default {
  data() {
        return {
          settingsID: 'settings',
          settings: null,
          signature: null,
          logo: null
  
        };
      },
  methods: {
      openAlert: function (text) {
        var self = this;
        self.$app.dialog.alert(text, "Flex Business");
        //alert(text);
      },
      test: function(){
        fakeAlert();
      },
      SignOutUser: function(){
        var self = this;
        self.$app.methods.signOutGlobal();
      },
      confirmDelete: function(){
        var self = this;
        var warn = "<div class='text-align-center text-color-red'><h4 class='margin-bottom-half'>Delete all your data</h4></div>";
        warn += "<div class='text-align-center'>This will delete all your data on this device</div>";
        warn += "<div class='text-align-center'>Type <b>Flex Business</b> in the textbox below to proceed</div>";
        self.$app.dialog.prompt(warn, function (name) {
          if(name.toLowerCase() == "Flex Business"){
            self.$app.dialog.confirm('Once deleted, data cannot be recovered except you have synced your data, do you want to proceed?', "Flex Business", function () {
              //self.$app.dialog.alert('Deleted');
              self.clearAllDB();
            });
          }else{
            //self.showToast("Flex Business not typed correctly");
          }
        });
      },
      showToast: function(text, position, time = 2000){
        var self = this;
        self.$app.toast.create({
                        text: text,
                        position: position,
                        closeTimeout: time,
                        }).open();
        },
        startPouch: function(){
          var self = this;
          mogulsheetdb = self.$app.methods.startPouch();
          self.getData();
          //db = null;
          
          /*try{//id,name,unit_size,unit,cost_per_unit,status,created_date
            mogulsheetdb = new PouchDB('mogulsheet.db');
            mogulsheetdb.createIndex({
              index: {
                fields: ['ingredientID','name', 'status'],
                name: 'ingredients',
                ddoc: 'mydesigndoc',
                type: 'json'
              }
            });

            mogulsheetdb.createIndex({
              index: {
                fields: ['clientID', 'created_date','parentID', 'product_name', 'isParent', 'buyer_name', 'status'],
                name: 'clients',
                ddoc: 'mydesigndoc',
                type: 'json'
              }
            });


            mogulsheetdb.getIndexes().then(function (result) {
              // yo, a result
              console.log(result);
            }).catch(function (err) {
              // ouch, an error
            });

              //self.syncDB();
              //self.getData();
          }catch(err){
            
            }*/
        },
        syncDB: function(){
          var self = this;
          $.ajax({
              url: "_all_dbs", 
              type:"GET",
              "crossDomain": true,
              success: function(result){
                
              },
              error: function(err){
                
              }
          });
          
        },
        getData: function(){
          var self = this;
          /*var id = self.settingsID;
          mogulsheetdb.get(id).then(function(doc) {
                var comName = doc.companyName;
                var curr = doc.currency;
                if(comName != "" & comName != null){
                  $(".compName").text(comName);
                  $(".compName").removeClass("display-none");
                }
                if(curr == undefined || curr == "" || curr == null){
                  self.showToast("Please visit Settings page to choose your currency and save company info!", "top", 3500);
                }
            }).catch(function(){
              self.showToast("Please visit Settings page to choose your currency and save company info!", "top", 3500);
            })

            dbSettingsImages.get('logoImage', {attachments: true}).then(function (blobOrBuffer) {

                    // handle result
                    self.$setState({
                      logo: blobOrBuffer
                    })
                    var attachments = blobOrBuffer._attachments.logoImage.data;
                    var type = blobOrBuffer._attachments.logoImage.content_type;

                    var imgPresent = $(".compName").find("img").length;
                    if(imgPresent == 0){
                      var img = "<img src='" + "data:"+ type + ";base64," + attachments + "' style='max-width:50px;margin-right:5px;'/>";
                      $(".compName").prepend(img);
                    }else{
                      var src = "data:"+ type + ";base64," + attachments;
                      $(".compName").find("img").attr("src", src);
                    }

                  }).catch(function (err) {
                  });*/
        },
      reloadPage: function(){
        var self = this;
        dbSettingsImages.get('logoImage', {attachments: true}).then(function (blobOrBuffer) {
                    // handle result
                    self.$setState({
                      logo: blobOrBuffer
                    })
                    var attachments = blobOrBuffer._attachments.logoImage.data;
                              var type = blobOrBuffer._attachments.logoImage.content_type;
                              var imgPresent = $(".compName").find("img").length;
                    if(imgPresent == 0){
                      var img = "<img src='" + "data:"+ type + ";base64," + attachments + "' style='max-width:50px;margin-right:5px;'/>";
                      $(".compName").prepend(img);
                    }else{
                      var src = "data:"+ type + ";base64," + attachments;
                      $(".compName").find("img").attr("src", src);
                    }
                  }).catch(function (err) {
                    
                  });
      },
      startDB: function(){
         //this.$app.methods.storage2();
          var self = this;
                
          //self.$app.dialog.alert("DB Created");
      },
      closePanel: function(){
        var self = this;
        var panel = self.$app.panel.get('.panel-left');

        if (panel.opened) {
          // do something
          console.log("panel opened");
          //$(".homeMenu").click();
          panel.toggle(false);
        }
      }
    },
    on: {
      pageMounted: function(e, page) {
        var self = this;
        //trackHomePage();
      },
      pageInit: function(e, page) {
        var self = this;
        self.startPouch();
      },
      pageAfterIn: function (event, page) {
          // do something after page gets into the view
          var self = this;
          //self.closePanel();
          //trackHomePage();

          //self.getData();
      }
    }
}

function trackHomePage(){
  //console.log("track home");
  try{
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
    'event': 'Pageview',
    'pagePath': 'https://www.mogulsheet.com/home',
    'pageTitle': 'Homepage' //some arbitrary name for the page/state
    });
    //console.log("track home success");
  }catch(err){
    //console.log("track home error");
  }
  
}
</script>